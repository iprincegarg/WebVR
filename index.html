<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>WebVR Video Player</title>
    <meta name="description" content="WebVR 360 Video Player">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        #overlay {
            position: absolute;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-family: sans-serif;
            flex-direction: column;
            cursor: pointer;
        }

        #overlay.hidden {
            display: none;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .play-btn {
            padding: 15px 30px;
            background: #e91e63;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }

        .play-btn:hover {
            background: #c2185b;
        }

        .upload-container {
            margin-bottom: 20px;
            text-align: center;
        }

        input[type="file"] {
            display: none;
        }

        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background: white;
            color: black;
            border-radius: 4px;
        }

        .seek-feedback {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 20px;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            /* Let clicks pass through */
            z-index: 2000;
            font-weight: bold;
        }

        .seek-feedback.left {
            left: 20%;
        }

        .seek-feedback.right {
            right: 20%;
        }

        .animate-feedback {
            animation: feedbackFade 0.6s ease-out forwards;
        }

        @keyframes feedbackFade {
            0% {
                opacity: 0;
                transform: translateY(-50%) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translateY(-50%) scale(1.1);
            }

            100% {
                opacity: 0;
                transform: translateY(-50%) scale(1.5);
            }
        }
    </style>
</head>

<body>
    <!-- Overlay for Play Button -->
    <div id="overlay">
        <h1>WebVR 360 Player</h1>

        <div class="upload-container">
            <label for="file-upload" class="custom-file-upload">
                <i class="fa fa-cloud-upload"></i> Upload Local Video
            </label>
            <input id="file-upload" type="file" accept="video/*" />
            <p id="file-name" style="font-size: 0.8em; margin-top: 5px;">No file selected (Using default)</p>
        </div>

        <button class="play-btn">Play Video</button>
    </div>

    <a-scene>
        <a-assets>
            <!-- Sample 360 video from A-Frame CDN -->
            <video id="video360" src="https://cdn.aframe.io/360-video-and-images/antarctica.mp4" loop="true"
                crossorigin="anonymous" playsinline webkit-playsinline></video>
        </a-assets>

        <!-- 360 Video Sphere -->
        <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

        <!-- Camera with look controls (mouse drag + gyro) -->
        <a-entity camera look-controls="reverseMouseDrag: true" position="0 0 0">
            <a-entity cursor="fuse: false; rayOrigin: mouse;" position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: black; shader: flat"
                visible="false">
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        const overlay = document.querySelector('#overlay');
        const video = document.querySelector('#video360');
        const playBtn = document.querySelector('.play-btn');
        const fileInput = document.querySelector('#file-upload');
        const fileNameDisplay = document.querySelector('#file-name');

        // Prevent overlay click from triggering play immediately if clicking upload
        // logic handled by specific event listeners below

        fileInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                const fileURL = URL.createObjectURL(file);
                video.src = fileURL;
                fileNameDisplay.textContent = "Selected: " + file.name;
            }
        });

        playBtn.addEventListener('click', function () {
            // Hide overlay
            overlay.classList.add('hidden');

            // Play video
            video.play();
        });

        // Video Seek Logic
        const SEEK_TIME = 10; // seconds
        let lastTapTime = 0;
        let lastTapX = 0;
        const DOUBLE_TAP_DELAY = 300; // ms
        const TAP_POSITION_THRESHOLD = 50; // px (max distance between taps)

        // Feedback Elements
        const feedbackContainer = document.createElement('div');
        feedbackContainer.innerHTML = `
            <div id="seek-feedback-left" class="seek-feedback left">
                <i class="fa fa-backward"></i>
                <span>-10s</span>
            </div>
            <div id="seek-feedback-right" class="seek-feedback right">
                <i class="fa fa-forward"></i>
                <span>+10s</span>
            </div>
        `;
        document.body.appendChild(feedbackContainer);

        const feedbackLeft = document.getElementById('seek-feedback-left');
        const feedbackRight = document.getElementById('seek-feedback-right');

        // Main Interaction Listener
        // We use 'click' because it works for both mouse and touch reasonably well for this simple case.
        // A-Frame captures some events, so we listen on the document or a specific container if possible.
        // listening on window/document ensuring we capture bubble up.

        window.addEventListener('click', (e) => {
            // Ignore clicks on buttons/inputs
            if (e.target.closest('button') || e.target.closest('input') || e.target.closest('label')) return;

            const currentTime = new Date().getTime();
            const tapGap = currentTime - lastTapTime;

            // Check double tap timing
            if (tapGap < DOUBLE_TAP_DELAY && tapGap > 0) {
                // Check distance (to avoid treating two distant taps as double tap)
                // (Optional for mouse, useful for touch if user uses two fingers lightly)
                // For simplicity, we just use X position.

                const width = window.innerWidth;
                const x = e.clientX;

                if (x < width * 0.3) {
                    // Left 30% - Rewind
                    seekVideo(-SEEK_TIME);
                    showFeedback(feedbackLeft);
                } else if (x > width * 0.7) {
                    // Right 30% - Forward
                    seekVideo(SEEK_TIME);
                    showFeedback(feedbackRight);
                }

                // Reset to prevent triple-tap triggering another immediate double
                lastTapTime = 0;
            } else {
                lastTapTime = currentTime;
            }
        });

        function seekVideo(timeChange) {
            if (!video) return;
            video.currentTime += timeChange;
        }

        function showFeedback(element) {
            // Reset animation
            element.style.display = 'flex';
            element.classList.remove('animate-feedback');

            // Trigger reflow
            void element.offsetWidth;

            element.classList.add('animate-feedback');

            // Hide after animation (approx match CSS transition)
            setTimeout(() => {
                element.style.display = 'none';
            }, 600);
        }

        // Handle simple keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (video.paused) video.play();
                else video.pause();
            } else if (e.code === 'ArrowRight') {
                seekVideo(SEEK_TIME);
                showFeedback(feedbackRight);
            } else if (e.code === 'ArrowLeft') {
                seekVideo(-SEEK_TIME);
                showFeedback(feedbackLeft);
            }
        });
    </script>

</body>

</html>
